<% layout("/layouts/boilerplate") %>

    <h3>Hello <%=userName%>!... Are you ready to complete your tasks</h3>
   <div class="card-container row gap-4 row-cols-lg-max-4">
<%for(let list of allList){%>
    <div class="card task-card" data-id="<%=list._id%>">
                        <a href="/List/<%= list._id %>"><img height="150rem" width="170rem" src="<%=list.image.url%>" class=" card-img-top"></a>
                        <br>
                        <h5 class="card-title"><%=list.title %>
                        <br></h5>
                        <br>
                       <div class="d-grid gap-2 col-6 mx-auto">
   

<div class=" gap-2 col-6 " id="formi" style="display: flex;justify-content: center;">
     <button class="btn btn-success col-6 complete-btn" 
     type="submit" style="background-color: <%= list.completed ? '#C9D892' : 'rgb(224, 90, 90)' %>;
     padding:0.3rem 0.1rem 0.3rem 0.1rem;
      width:6rem;display: inline;
      color: black;">
     <%=list.completed?"Completed":"Complete"%>
    </button>

     <a href="/List/<%= list._id %>/edit" class="col-6" style="color:white; text-decoration: none;"> <button class="btn btn-dark" type="button" style="background-color: rgb(95, 95, 95); color:white;padding:0.3rem 0 0.3rem 0;width:3rem ;display: inline">
   Edit</button></a>
</div>   
              
  
</div>

     </div>
<%}%>


    </div>

    <script>
document.querySelectorAll('.complete-btn').forEach(button => {
  button.addEventListener('click', async function (event) {
    event.preventDefault(); // prevent form submission / page reload
    const card = this.closest('.task-card');
    const taskId = card.dataset.id;

    try {
      // Send request to backend to toggle completion
      const res = await fetch(`/List/${taskId}/toggle-complete`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' }
      });

      const data = await res.json();

      if (data.success) {
        // ✅ Update button color and text dynamically
        if (data.completed) {
          this.style.backgroundColor = '#C9D892';
          this.textContent = 'Completed';
        } else {
          this.style.backgroundColor = 'rgb(224, 90, 90)';
          this.textContent = 'Complete';
        }

        // ✅ Update the counter in header dynamically
        const counterDisplay = document.querySelector(".header .completed-count");
        if (counterDisplay && data.completedCount !== undefined) {
          counterDisplay.textContent = data.completedCount;
        }
      } else {
        alert('Error updating task');
      }
    } catch (err) {
      console.error(err);
      alert('Something went wrong!');
    }
  });
});
</script>



